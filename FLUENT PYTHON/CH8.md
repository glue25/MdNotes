# 内容概述

- 介绍了变量的性质：变量是一个标签，像指针
- `is`与`id()`的底层行为。
- 元组与多数 Python 集合（列表、字典、集，等等）一样，保存的是对象的引用。而 str、bytes 和 array.array 等单一类型序列是扁平的，它们保存的不是引用，而是在连续的内存中保存数据本身（字符、字节和数字）。
- 元组的相对不可变性，元组内的可变对象还是可变的，并且元组在`id()`的结果不变。
- 默认和`copy.copy()`都是在做浅复制，即复制了最外层容器，副本中的元素是源容器中元素的引用。改变副本中的**可变元素**会使原变量中的相应变量改变。
- 不能用可变对象作默认参数，这会改变`__init__.__defaults__`，造成很多莫名其妙的问题。
- 弱引用的定义。
- 弱引用有生命卡的感觉，如果弱引用的所指对象消失了，则弱引用也会消失。
- 书中提到了CPython在实现时的优化细节，这些不必太在意。
- 作者推荐了一个<a href='http://www.pythontutor.com'>教学用的网站</a>



# 变量

## 变量的性质

Python中的变量是标签，而不是盒子，不同的标签可以贴在同一个数据上。

不同的变量可能值是一样的。

## is与==

`id()`函数返回对象的唯一表示，在`CPython`中`id()`返回对象的内存地址。不过编程中更常用的是`is`运算符，`is`运算符就是在比较两个对象的`id()`函数返回值。

`==`就是`.__eq__()`，速度会比`is`慢一些。*<u>自定义类的对象中，如果没重写`__eq__`那么会直接调用`id()`进行对比，标准库数据类型的`__eq__`一般都重写过了</u>*。

## 元组的相对不可变性

**<u>元组与多数 Python 集合（列表、字典、集，等等）一样，保存的是对象的引用。</u>**而 str、bytes 和 array.array 等单一类型序列是扁平的，它们保存的不是引用，而是在连续的内存中保存数据本身（字符、字节和数字）。

元组本身是不可变的，然而元组内存的只是对象的引用，所以改变元组内对象（如list）的值是可行的，从更常见的场景来说，改变元组中的list是不会报错的。

# 复制

## 默认做浅复制

浅复制即复制了最外层容器，副本中的元素是源容器中元素的引用。改变副本中的**可变元素**会使原变量中的相应变量改变，如果改变的是不可变元素（如tuple），副本会新建一个不可变元素。这样也是有好处的，由于只是复制了地址，所以省内存。

## 深复制与浅复制

`copy.copy()`和`copy.deepcopy()`分别进行浅复制和深复制。深复制可能太深了，这个可以通过实现特殊方法` __copy__()` 和` __deepcopy__()`进行控制（具体还是要看<a href='http://docs.python.org/3/library/copy.html'>copy模块的文档</a>）。

# 函数的参数作为引用时

共享传参，内部形参是实参的别名。所以**可变对象可能被改变，无法对对象进行替换**。

**不能用可变类型作为参数的默认值**，因为这会改变`__init__.__defaults__`，副作用很大。可以通过以None作为默认参数然后再做处理的方式来进行规避。

**考虑到Python中的各种运算，如+，+=，*=实质上都是调用了`__XXX__`函数，所以不难猜出进行这些运算后，右值是不是原有对象**。

# del和垃圾回收

del删的是名称，不是变量。在CPython中，没有引用指向对象时，对象就被删除了对象立即就被销毁：CPython 会在对象上调用 `__del__`方法（如果定义了），然后释放分配给对象的内存，如果循环引用的所有引用都无法被获取，同样会被删除。**不同的解释器的垃圾回收机制是不一样的**。

# 弱引用

弱引用不会增加对象的引用数量。引用的目标对象称为所指对象（referent）。因此我们说，弱引用不会妨碍所指对象被当作垃圾回收。

***<u>没看出来有什么用，暂时大概用不上</u>***

一个用法是，如果弱引用的所指对象消失了，则弱引用也会消失，有点生命卡的感觉。

## 局限

*<u><这些局限基本上是 CPython 的实现细节，在其他 Python 解释器中情况可能不一样。/u>*

不是每个 Python 对象都可以作为弱引用的目标（或称所指对象）。基本的 list 和 dict 实例不能作为所指对象，但是它们的子类可以。int 和 tuple 实例不能作为弱引用的目标，甚至它们的子类也不行。

set 实例可以作为所指对象，用户定义的类型也没问题。



# CPython的优化细节

比如浅复制元组后不会马上创建新对象，比如字符串的驻留。这些先暂时不用管。





==提示==作者推荐了一个<a href='http://www.pythontutor.com'>教学用的网站</a>